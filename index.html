<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SASTIK GBQ+ Verse Filter</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h2, .mission-statement { text-align: center; }
    .controls { display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap; }
    #categoryFilter, #sheetSelector, #searchInput { padding: 5px; }
    table { border-collapse: collapse; width: 100%; max-width: 100%; overflow-x: auto; }
    th { border: 1px solid #ddd; padding: 4px; text-align: left; color: black; } /* Ensure black text */
    td { border: 1px solid #ddd; padding: 8px; text-align: left; }
    .mission-statement { margin-bottom: 15px; padding: 10px; background-color: #f9f9f9; border-left: 4px solid #4CAF50; }
    .last-updated, .content-count { font-size: 0.9em; color: #666; margin: 0; }
    /* Sheet-specific header colors with black text */
    th[data-sheet="Gita"] { background-color: orange; }
    th[data-sheet="Bible"] { background-color: blue; }
    th[data-sheet="Quran"] { background-color: darkgreen; }
    @media (max-width: 600px) {
      table { font-size: 14px; }
      th { padding: 2px; font-size: 0.9em; }
      td { padding: 4px; }
      .mission-statement { font-size: 0.9em; }
      .controls { flex-direction: column; }
    }
  </style>
</head>
<body>
  <h2>SASTIK GBQ+</h2>
  <div class="mission-statement">
    ‡¶∏‡ßÅ‡¶∏‡ßç‡¶• ‡¶Ü‡¶∏‡ßç‡¶§‡¶ø‡¶ï‡¶§‡¶æ ‡¶™‡ßç‡¶∞‡¶ö‡¶æ‡¶∞‡ßá‡¶∞ ‡¶â‡¶¶‡ßç‡¶¶‡ßá‡¶∂‡ßç‡¶Ø‡ßá, ‡¶π‡¶ø‡¶Ç‡¶∏‡¶æ ‡¶ì ‡¶¨‡¶ø‡¶¶‡ßç‡¶¨‡ßá‡¶∑‡ßá‡¶∞ ‡¶¨‡¶ø‡¶∞‡ßÅ‡¶¶‡ßç‡¶ß‡ßá <b>üö´</b> ‡¶∏‡¶Æ‡ßç‡¶™‡ßç‡¶∞‡ßÄ‡¶§‡¶ø ‡¶ì ‡¶Æ‡¶æ‡¶®‡¶¨‡¶§‡¶æ‡¶∞ ‡¶™‡¶ï‡ßç‡¶∑‡ßá <em>‚úÖ</em><br>
    To propagate sane theism, against hatred and violence <b>üö´</b> in favor of harmony and humanity <em>‚úÖ</em>
  </div>
  <div class="controls">
    <label for="sheetSelector">Select Sheet:</label>
    <select id="sheetSelector" onchange="loadSheetData()">
      <option value="">Select a sheet</option>
    </select>
    <label for="categoryFilter">Filter by Category:</label>
    <select id="categoryFilter" onchange="filterTable()">
      <option value="">All</option>
      <option value="Universal or Ethical Verse">Universal or Ethical Verse</option>
      <option value="General Intra-community Verse">General Intra-community Verse</option>
      <option value="Controversial Intra-community Verse">Controversial Intra-community Verse</option>
      <option value="Divisive or Hateful Inter-community Verse">Divisive or Hateful Inter-community Verse</option>
      <option value="Violent or Aggressive Inter-community Verse">Violent or Aggressive Inter-community Verse</option>
    </select>
    <label for="searchInput">Search:</label>
    <input type="text" id="searchInput" onkeyup="searchTable()" placeholder="e.g., Genesis 2.5, Gita 11.5">
    <span class="last-updated" id="lastUpdated">Last updated: loading...</span>
    <span class="content-count" id="contentCount">Content found: 0</span>
  </div>
  <table id="verseTable">
    <thead id="tableHeaders">
      <tr>
        <th data-sheet="">Verse Category</th>
        <th data-sheet="">Sub Category</th>
        <th data-sheet="">Verse Name</th>
        <th data-sheet="">Bengali Translation</th>
        <th data-sheet="">Verse in English</th>
        <th data-sheet="">Hindi Meaning</th>
        <th data-sheet="">Reference Links</th>
        <th data-sheet="">SGS Remarks</th>
        <th data-sheet="">Sheet</th>
      </tr>
    </thead>
    <tbody id="verseBody"></tbody>
  </table>

  <script>
    fetch('data.json')
      .then(response => response.json())
      .then(data => {
        const lastUpdated = new Date(document.lastModified).toLocaleString('en-IN', { timeZone: 'Asia/Kolkata' });
        document.getElementById('lastUpdated').textContent = `Last updated: ${lastUpdated}`;

        let allVerses = [];
        let sheetNames = Object.keys(data);
        const sheetSelect = document.getElementById('sheetSelector');
        sheetNames.forEach(sheet => {
          const option = document.createElement('option');
          option.value = sheet;
          option.textContent = sheet;
          sheetSelect.appendChild(option);
          allVerses = allVerses.concat(data[sheet].map(v => ({ ...v, sheet })));
        });

        // Display all verses initially
        displayVerses(allVerses);

        window.loadSheetData = function() {
          const selectedSheet = sheetSelect.value;
          const filtered = selectedSheet ? allVerses.filter(v => v.sheet === selectedSheet) : allVerses;
          updateHeaderColors(selectedSheet);
          filterTable(filtered);
        };

        window.filterTable = function(filteredData = allVerses) {
          const category = document.getElementById('categoryFilter').value;
          let filtered = category ? filteredData.filter(v => (v['Verse Category'] || '').trim() === category) : filteredData;
          console.log('Filtering by category:', category, 'Result count:', filtered.length); // Debug log
          searchTable(filtered); // Chain with search
        };

        window.searchTable = function(filteredData = allVerses) {
          const searchTerm = document.getElementById('searchInput').value.toLowerCase().trim();
          let filtered = filteredData;
          if (searchTerm) {
            filtered = filteredData.filter(v => {
              return Object.values(v).some(val =>
                val && typeof val === 'string' && val.toLowerCase().includes(searchTerm) ||
                (typeof val === 'object' && val.text && val.text.toLowerCase().includes(searchTerm))
              );
            });
          }
          displayVerses(filtered);
        };

        function updateHeaderColors(sheet) {
          const ths = document.querySelectorAll('th[data-sheet]');
          ths.forEach(th => {
            th.setAttribute('data-sheet', sheet || '');
          });
        }

        function displayVerses(verses) {
          const tbody = document.getElementById('verseBody');
          tbody.innerHTML = '';
          document.getElementById('contentCount').textContent = `Content found: ${verses.length}`;
          verses.forEach(verse => {
            const row = document.createElement('tr');
            const columns = [
              'Verse Category', 'Sub Category', 'Verse Name', 'Bengali Translation',
              'Verse in English', 'Hindi Meaning', 'Reference Links', 'SGS Remarks'
            ];
            columns.forEach(column => {
              const content = typeof verse[column] === 'object' && verse[column].url
                ? `<a href="${verse[column].url}" target="_blank">${verse[column].text}</a>`
                : verse[column] || '';
              const td = document.createElement('td');
              td.innerHTML = content;
              row.appendChild(td);
            });
            const sheetTd = document.createElement('td');
            sheetTd.textContent = verse.sheet;
            row.appendChild(sheetTd);
            tbody.appendChild(row);
          });
        }
      })
      .catch(error => console.error('Error loading data:', error));
  </script>
</body>
</html>
