<!DOCTYPE html>
<html>
  <head>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
        background-color: #f9f9f9;
        display: flex;
        flex-direction: column;
        min-height: 100vh;
      }
      h2 {
        color: #333;
        text-align: center;
        margin-bottom: 20px;
        font-size: 2.5em;
        font-weight: bold;
      }
      .mission-statement {
        text-align: center;
        margin: 0 auto 20px auto;
        max-width: 80%;
        font-size: 1.1em;
        line-height: 1.5;
        font-weight: bold;
      }
      .mission-statement b {
        color: #ff0000; /* Red for üö´ */
      }
      .mission-statement em {
        color: #00ff00; /* Green for ‚úÖ */
      }
      .controls {
        margin-bottom: 20px;
        text-align: center;
        position: relative;
      }
      .content-count {
        position: absolute;
        top: 0;
        right: 0;
        font-size: 1em;
        color: #333;
      }
      select, input {
        padding: 5px;
        margin-right: 10px;
      }
      table {
        border-collapse: collapse;
        width: 80%;
        margin: 0 auto;
        background-color: #fff;
        box-shadow: 0 0 10px rgba(0,0,0,0.1);
        flex-grow: 1;
      }
      th, td {
        border: 1px solid #ddd;
        padding: 10px;
        text-align: center;
      }
      td a {
        color: #0066cc;
        text-decoration: none;
      }
      td a:hover {
        text-decoration: underline;
      }
      /* Color Verse Category items */
      td.category-universal { background-color: #00FF00; } /* Green */
      td.category-general { background-color: #00FFFF; } /* Cyan */
      td.category-controversial { background-color: #FFFF00; } /* Yellow */
      td.category-divisive { background-color: #FF0000; } /* Red */
      td.category-violent { background-color: #000000; color: #FFFFFF; } /* Black with white text */
      /* Responsive Design */
      @media (max-width: 600px) {
        table { width: 100%; }
        .mission-statement { font-size: 0.9em; max-width: 90%; }
        h2 { font-size: 2em; }
        select, input { width: 100%; margin-bottom: 10px; }
        .controls { flex-direction: column; align-items: center; }
        .content-count { position: static; text-align: center; margin-top: 10px; }
      }
    </style>
  </head>
  <body>
    <h2>SASTIK GBQ+</h2>
    <div class="mission-statement">
      ‡¶∏‡ßÅ‡¶∏‡ßç‡¶• ‡¶Ü‡¶∏‡ßç‡¶§‡¶ø‡¶ï‡¶§‡¶æ ‡¶™‡ßç‡¶∞‡¶ö‡¶æ‡¶∞‡ßá‡¶∞ ‡¶â‡¶¶‡ßç‡¶¶‡ßá‡¶∂‡ßç‡¶Ø‡ßá, ‡¶π‡¶ø‡¶Ç‡¶∏‡¶æ ‡¶ì ‡¶¨‡¶ø‡¶¶‡ßç‡¶¨‡ßá‡¶∑‡ßá‡¶∞ ‡¶¨‡¶ø‡¶∞‡ßÅ‡¶¶‡ßç‡¶ß‡ßá <b>üö´</b> ‡¶∏‡¶Æ‡ßç‡¶™‡ßç‡¶∞‡ßÄ‡¶§‡¶ø ‡¶ì ‡¶Æ‡¶æ‡¶®‡¶¨‡¶§‡¶æ‡¶∞ ‡¶™‡¶ï‡ßç‡¶∑‡ßá <em>‚úÖ</em><br>
      To propagate sane theism, against hatred and violence <b>üö´</b> in favor of harmony and humanity <em>‚úÖ</em>
    </div>
    <div class="controls">
      <label for="sheetSelector">Select Sheet:</label>
      <select id="sheetSelector" onchange="loadSheetData()">
        <option value="">Select a sheet</option>
      </select>
      <label for="categoryFilter">Filter by Category:</label>
      <select id="categoryFilter" onchange="filterTable()" disabled>
        <option value="">All</option>
        <option value="Universal or Ethical Verse">Universal or Ethical Verse</option>
        <option value="General Intra-community Verse">General Intra-community Verse</option>
        <option value="Controversial Intra-community Verse">Controversial Intra-community Verse</option>
        <option value="Divisive or Hateful Inter-community Verse">Divisive or Hateful Inter-community Verse</option>
        <option value="Violent or Aggressive Inter-community Verse">Violent or Aggressive Inter-community Verse</option>
      </select>
      <input type="text" id="searchInput" placeholder="Search in table..." onkeyup="searchTable()" disabled>
      <div class="content-count" id="contentCount">Contents: 0</div>
    </div>
    <table id="verseTable">
      <thead id="tableHeaders"></thead>
      <tbody id="verseBody"></tbody>
    </table>
    <script>
      let data = [];
      let hyperlinks = [];

      function loadSheetData() {
        const sheetName = document.getElementById("sheetSelector").value;
        if (sheetName) {
          document.getElementById("categoryFilter").disabled = false;
          document.getElementById("searchInput").disabled = false;
          google.script.run.withSuccessHandler(function(dataObj) {
            data = dataObj.rows;
            hyperlinks = dataObj.hyperlinks;
            updateHeaders(dataObj.headers, dataObj.headerColors);
            updateTable(data, hyperlinks, dataObj.totalRows);
            updateContentCount(data.length);
          }).getSheetData(sheetName, "");
        } else {
          document.getElementById("categoryFilter").disabled = true;
          document.getElementById("searchInput").disabled = true;
          document.getElementById("verseBody").innerHTML = "";
          document.getElementById("tableHeaders").innerHTML = "";
          updateContentCount(0);
        }
      }

      function updateHeaders(headers, headerColors) {
        const thead = document.getElementById("tableHeaders");
        thead.innerHTML = "";
        let tr = document.createElement("tr");
        headers.forEach((header, index) => {
          if (header && header.trim()) {
            let th = document.createElement("th");
            th.textContent = header.trim();
            th.style.backgroundColor = headerColors[index] || "#4CAF50";
            th.style.color = getTextColor(headerColors[index]);
            tr.appendChild(th);
          }
        });
        thead.appendChild(tr);
      }

      function getTextColor(backgroundColor) {
        if (!backgroundColor) return "#000000";
        const rgb = hexToRgb(backgroundColor);
        if (rgb) {
          const brightness = (rgb.r * 299 + rgb.g * 587 + rgb.b * 114) / 1000;
          return brightness > 128 ? "#000000" : "#FFFFFF";
        }
        return "#000000";
      }

      function hexToRgb(hex) {
        const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
        return result ? {
          r: parseInt(result[1], 16),
          g: parseInt(result[2], 16),
          b: parseInt(result[3], 16)
        } : null;
      }

      function updateTable(rows, hyperlinks, totalRows) {
        const tbody = document.getElementById("verseBody");
        tbody.innerHTML = "";
        rows.forEach((row, rowIndex) => {
          let tr = document.createElement("tr");
          row.forEach((cell, colIndex) => {
            let td = document.createElement("td");
            // Apply color coding to Verse Category (index 0)
            if (colIndex === 0 && typeof cell === "string") {
              td.className = getCategoryClass(cell.trim().toLowerCase());
            }
            // Apply hyperlink to Verse Name (index 3) using Reference Links and Files (index 4)
            if (colIndex === 3 && hyperlinks[rowIndex] && hyperlinks[rowIndex][0]) {
              let linkUrl = hyperlinks[rowIndex][0];
              if (linkUrl && linkUrl.trim().length > 0) {
                let displayText = cell || hyperlinks[rowIndex][1] || "Link";
                let a = document.createElement("a");
                a.href = linkUrl;
                a.textContent = displayText;
                a.target = "_blank";
                td.appendChild(a);
              } else {
                td.textContent = cell || "";
              }
            } else {
              td.textContent = cell || "";
            }
            tr.appendChild(td);
          });
          tbody.appendChild(tr);
        });
        updateContentCount(rows.length);
      }

      function getCategoryClass(category) {
        switch (category.toLowerCase()) {
          case "universal or ethical verse": return "category-universal";
          case "general intra-community verse": return "category-general";
          case "controversial intra-community verse": return "category-controversial";
          case "divisive or hateful inter-community verse": return "category-divisive";
          case "violent or aggressive inter-community verse": return "category-violent";
          default: return "";
        }
      }

      function filterTable() {
        const sheetName = document.getElementById("sheetSelector").value;
        const category = document.getElementById("categoryFilter").value;
        if (sheetName) {
          google.script.run.withSuccessHandler(function(dataObj) {
            data = dataObj.rows;
            hyperlinks = dataObj.hyperlinks;
            updateHeaders(dataObj.headers, dataObj.headerColors);
            let filteredRows = category === "" ? data : data.filter(row => row[0] && row[0].toString().trim().toLowerCase() === category.toLowerCase());
            let filteredHyperlinks = category === "" ? hyperlinks : hyperlinks ? hyperlinks.filter((_, i) => data[i][0] && data[i][0].toString().trim().toLowerCase() === category.toLowerCase()) : null;
            updateTable(filteredRows, filteredHyperlinks, dataObj.totalRows);
          }).getSheetData(sheetName, category);
        }
      }

      function searchTable() {
        let input = document.getElementById("searchInput").value.toLowerCase();
        let rows = document.getElementById("verseBody").getElementsByTagName("tr");
        let visibleCount = 0;
        for (let i = 0; i < rows.length; i++) {
          let cells = rows[i].getElementsByTagName("td");
          let found = false;
          for (let j = 0; j < cells.length; j++) {
            let text = cells[j].textContent.toLowerCase();
            if (text.includes(input)) {
              found = true;
              break;
            }
          }
          rows[i].style.display = found ? "" : "none";
          if (found) visibleCount++;
        }
        updateContentCount(visibleCount);
      }

      function updateContentCount(count) {
        document.getElementById("contentCount").textContent = `Contents: ${count}`;
      }

      // Load sheet names on page load
      google.script.run.withSuccessHandler(function(sheets) {
        const select = document.getElementById("sheetSelector");
        sheets.forEach(sheet => {
          let option = document.createElement("option");
          option.value = sheet;
          option.textContent = sheet;
          select.appendChild(option);
        });
      }).getSheetNames();
    </script>
  </body>
</html>
