<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SASTIK GBQ+ Verse Filter</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h2, .mission-statement { text-align: center; }
    #categoryFilter, #sheetSelector { margin-bottom: 10px; padding: 5px; }
    table { border-collapse: collapse; width: 100%; max-width: 100%; overflow-x: auto; }
    th { border: 1px solid #ddd; padding: 8px; text-align: left; }
    td { border: 1px solid #ddd; padding: 8px; text-align: left; }
    .mission-statement { margin-bottom: 15px; padding: 10px; background-color: #f9f9f9; border-left: 4px solid #4CAF50; }
    .controls { margin-bottom: 15px; }
    .last-updated, .content-count { font-size: 0.9em; color: #666; margin-top: 10px; text-align: center; }
    @media (max-width: 600px) {
      table { font-size: 14px; }
      th, td { padding: 4px; }
      .mission-statement { font-size: 0.9em; }
    }
    /* Sheet-specific header colors */
    th[data-sheet="Gita"] { background-color: orange; color: white; }
    th[data-sheet="Bible"] { background-color: blue; color: white; }
    th[data-sheet="Quran"] { background-color: darkgreen; color: white; }
  </style>
</head>
<body>
  <h2>SASTIK GBQ+</h2>
  <div class="mission-statement">
    ‡¶∏‡ßÅ‡¶∏‡ßç‡¶• ‡¶Ü‡¶∏‡ßç‡¶§‡¶ø‡¶ï‡¶§‡¶æ ‡¶™‡ßç‡¶∞‡¶ö‡¶æ‡¶∞‡ßá‡¶∞ ‡¶â‡¶¶‡ßç‡¶¶‡ßá‡¶∂‡ßç‡¶Ø‡ßá, ‡¶π‡¶ø‡¶Ç‡¶∏‡¶æ ‡¶ì ‡¶¨‡¶ø‡¶¶‡ßç‡¶¨‡ßá‡¶∑‡ßá‡¶∞ ‡¶¨‡¶ø‡¶∞‡ßÅ‡¶¶‡ßç‡¶ß‡ßá <b>üö´</b> ‡¶∏‡¶Æ‡ßç‡¶™‡ßç‡¶∞‡ßÄ‡¶§‡¶ø ‡¶ì ‡¶Æ‡¶æ‡¶®‡¶¨‡¶§‡¶æ‡¶∞ ‡¶™‡¶ï‡ßç‡¶∑‡ßá <em>‚úÖ</em><br>
    To propagate sane theism, against hatred and violence <b>üö´</b> in favor of harmony and humanity <em>‚úÖ</em>
  </div>
  <div class="controls">
    <label for="sheetSelector">Select Sheet:</label>
    <select id="sheetSelector" onchange="loadSheetData()">
      <option value="">Select a sheet</option>
    </select>
    <label for="categoryFilter">Filter by Category:</label>
    <select id="categoryFilter" onchange="filterTable()">
      <option value="">All</option>
      <option value="Universal or Ethical Verse">Universal or Ethical Verse</option>
      <option value="General Intra-community Verse">General Intra-community Verse</option>
      <option value="Controversial Intra-community Verse">Controversial Intra-community Verse</option>
      <option value="Divisive or Hateful Inter-community Verse">Divisive or Hateful Inter-community Verse</option>
      <option value="Violent or Aggressive Inter-community Verse">Violent or Aggressive Inter-community Verse</option>
    </select>
  </div>
  <div class="last-updated" id="lastUpdated">Last updated: loading...</div>
  <div class="content-count" id="contentCount">Content found: 0</div>
  <table id="verseTable">
    <thead id="tableHeaders"></thead>
    <tbody id="verseBody"></tbody>
  </table>

  <script>
    fetch('data.json')
      .then(response => response.json())
      .then(data => {
        const lastUpdated = new Date(document.lastModified).toLocaleString('en-IN', { timeZone: 'Asia/Kolkata' });
        document.getElementById('lastUpdated').textContent = `Last updated: ${lastUpdated}`;

        let allVerses = [];
        let sheetNames = Object.keys(data);
        const sheetSelect = document.getElementById('sheetSelector');
        sheetNames.forEach(sheet => {
          const option = document.createElement('option');
          option.value = sheet;
          option.textContent = sheet;
          sheetSelect.appendChild(option);
          allVerses = allVerses.concat(data[sheet].map(v => ({ ...v, sheet })));
        });

        // Dynamically generate headers from the first row of each sheet
        const uniqueHeaders = new Set();
        sheetNames.forEach(sheet => {
          if (data[sheet].length > 0) {
            Object.keys(data[sheet][0]).filter(h => h !== 'sheet').forEach(header => uniqueHeaders.add(header));
          }
        });
        const headers = Array.from(uniqueHeaders);
        const thead = document.getElementById('tableHeaders');
        const headerRow = document.createElement('tr');
        headers.forEach(header => {
          const th = document.createElement('th');
          th.textContent = header;
          th.setAttribute('data-sheet', sheetNames[0]); // Default color based on first sheet
          headerRow.appendChild(th);
        });
        const sheetTh = document.createElement('th');
        sheetTh.textContent = 'Sheet';
        headerRow.appendChild(sheetTh);
        thead.appendChild(headerRow);

        // Display all verses initially
        displayVerses(allVerses);

        window.loadSheetData = function() {
          const selectedSheet = sheetSelect.value;
          const filtered = selectedSheet ? allVerses.filter(v => v.sheet === selectedSheet) : allVerses;
          updateHeaderColors(selectedSheet);
          filterTable(filtered);
        };

        window.filterTable = function(filteredData = allVerses) {
          const category = document.getElementById('categoryFilter').value;
          const filtered = category ? filteredData.filter(v => (v['Verse Category'] || '') === category) : filteredData;
          displayVerses(filtered);
        };

        function updateHeaderColors(sheet) {
          const ths = document.querySelectorAll('th[data-sheet]');
          ths.forEach(th => {
            th.setAttribute('data-sheet', sheet || sheetNames[0]);
          });
        }

        function displayVerses(verses) {
          const tbody = document.getElementById('verseBody');
          tbody.innerHTML = '';
          document.getElementById('contentCount').textContent = `Content found: ${verses.length}`;
          verses.forEach(verse => {
            const row = document.createElement('tr');
            headers.forEach(header => {
              const content = typeof verse[header] === 'object' && verse[header].url
                ? `<a href="${verse[header].url}" target="_blank">${verse[header].text}</a>`
                : verse[header] || '';
              const td = document.createElement('td');
              td.innerHTML = content;
              row.appendChild(td);
            });
            const sheetTd = document.createElement('td');
            sheetTd.textContent = verse.sheet;
            row.appendChild(sheetTd);
            tbody.appendChild(row);
          });
        }
      })
      .catch(error => console.error('Error loading data:', error));
  </script>
</body>
</html>
