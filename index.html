<table id="verseTable">
  <thead id="tableHeaders"></thead>
  <tbody id="verseBody"></tbody>
</table>

<script>
  // global vars
  let allData = [], headers = [];

  async function loadSheet() {
    // example fetching data - replace this with your fetch
    const data = await fetch("YOUR_DATA_SOURCE_URL").then(r => r.json());
    allData = data;
    headers = Object.keys(allData[0]);
    buildTable();
  }

  function buildTable(filterCategory = "") {
    const thead = document.getElementById("tableHeaders");
    const tbody = document.getElementById("verseBody");

    thead.innerHTML = "";
    tbody.innerHTML = "";

    // Build header row with a filter for "Verse Category"
    const trHead = document.createElement("tr");

    headers.forEach(hdr => {
      const th = document.createElement("th");
      if (hdr === "Verse Category") {
        // Create select dropdown for filtering categories
        const select = document.createElement("select");
        const categories = [...new Set(allData.map(row => row[hdr]).filter(Boolean))];
        const defaultOption = document.createElement("option");
        defaultOption.value = "";
        defaultOption.textContent = "All Categories";
        select.appendChild(defaultOption);

        categories.forEach(cat => {
          const opt = document.createElement("option");
          opt.value = cat;
          opt.textContent = cat;
          select.appendChild(opt);
        });

        select.value = filterCategory;
        select.addEventListener("change", e => buildTable(e.target.value));

        th.appendChild(select);
      } else {
        th.textContent = hdr;
      }
      trHead.appendChild(th);
    });
    thead.appendChild(trHead);

    // Filter rows if category selected
    let filteredData = filterCategory ? allData.filter(r => r["Verse Category"] === filterCategory) : allData;

    // Build rows
    filteredData.forEach(row => {
      const tr = document.createElement("tr");
      headers.forEach(hdr => {
        const td = document.createElement("td");
        td.textContent = row[hdr] || "";
        tr.appendChild(td);
      });
      tbody.appendChild(tr);
    });
  }

  loadSheet();
</script>
