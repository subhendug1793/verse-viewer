<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SASTIK GBQ+ Verse Filter</title>
  <meta property="og:title" content="SASTIK GBQ+ Verse">
  <meta property="og:description" content="Explore categorized theological verses from the Gita, Bible, Quran, and more.">
  <meta property="og:image" content="https://subhendug1793.github.io/verse-viewer/images/sastik_logo.png">
  <meta property="og:url" content="https://subhendug1793.github.io/verse-viewer/">
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Merriweather:wght@400;700&display=swap" rel="stylesheet">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body { 
      font-family: 'Poppins', sans-serif; 
      margin: 20px; 
      background: #f9f9f9; 
      position: relative; 
      min-height: 100vh; 
      display: flex;
      flex-direction: column;
    }
    .header-container { 
      display: flex; 
      justify-content: center; 
      align-items: center; 
      margin-bottom: 20px; 
    }
    .header-info { 
      display: flex; 
      justify-content: space-between; 
      align-items: center; 
      width: 100%; 
      position: absolute; 
      top: 20px; 
      left: 20px; 
      right: 20px; 
      font-size: 0.9em; 
      color: #666; 
      z-index: 10; 
    }
    .header-info .last-updated {
      position: absolute; 
      right: 20px; 
    }
    .header-info .last-updated a {
      color: #0066cc;
      text-decoration: none;
    }
    .header-info .visitor-count {
      position: absolute; 
      left: 0; 
      font-weight: bold;
      color: #333;
      z-index: 10;
    }
    .header-info .visitor-count.error {
      font-weight: normal;
      color: #999;
    }
    .logo { 
      width: 80px; 
      height: auto; 
      margin-right: 10px; 
    }
    h2 { 
      font-family: 'Merriweather', serif;
      color: #0066cc;
      text-align: center; 
      margin: 0; 
      font-size: 1.8em;
      font-weight: bold; 
      white-space: nowrap; 
      text-decoration: none; 
    }
    h2 a { 
      color: #0066cc; 
      text-decoration: none; 
    }
    h2 a:hover { 
      text-decoration: underline; 
    }
    .mission-statement { 
      font-family: 'Merriweather', serif;
      text-align: center; 
      margin: 0 auto 10px;
      max-width: 80%; 
      font-size: 1.1em; 
      line-height: 1.5; 
      font-weight: bold; 
    }
    .mission-subtext { 
      text-align: center; 
      margin: 0 auto 20px; 
      max-width: 90%; 
      font-size: 0.75em; 
      line-height: 1.2; 
      font-weight: normal; 
      white-space: nowrap; 
    }
    .controls { 
      margin-bottom: 10px; 
      text-align: center; 
      display: flex; 
      justify-content: center; 
      align-items: center; 
      gap: 2px; 
      flex-wrap: wrap; 
    }
    .search-row { 
      display: flex; 
      justify-content: center; 
      align-items: center; 
      gap: 10px; 
      margin-bottom: 5px;
    }
    .content-count, .match-count { 
      font-size: 1em; 
      color: #333; 
      text-align: left; 
    }
    .search-input-container {
      flex-grow: 0;
      text-align: center;
    }
    select, input { 
      font-family: 'Poppins', sans-serif;
      padding: 5px; 
      margin-right: 10px; 
    }
    select:disabled, input:disabled {
      background-color: #e0e0e0;
      cursor: not-allowed;
    }
    #searchInput { 
      width: 200px; 
    }
    .verse-container { 
      width: 80%; 
      margin: 0 auto 20px; 
      display: flex; 
      flex-direction: column; 
      gap: 25px; 
    }
    .verse-card { 
      background: linear-gradient(135deg, #ffffff, #f9f9f9); 
      box-shadow: 0 4px 15px rgba(0,0,0,0.1); 
      padding: 20px; 
      border-radius: 12px; 
      display: flex; 
      flex-direction: column; 
      align-items: center; 
      gap: 12px; 
      transition: transform 0.2s, box-shadow 0.2s; 
      border: 1px solid rgba(0,102,204,0.1); 
    }
    .verse-card:hover { 
      transform: scale(1.02); 
      box-shadow: 0 6px 20px rgba(0,0,0,0.15); 
    }
    .verse-header { 
      display: flex; 
      width: 100%; 
      justify-content: space-between; 
      align-items: center; 
      padding: 6px 0; /* CHANGED */
      border-bottom: 1px solid rgba(0,0,0,0.1); 
    }
    .verse-header.category-universal { 
      background-color: #00FF00; 
    }
    .verse-header.category-general { 
      background-color: #00FFFF; 
    }
    .verse-header.category-controversial { 
      background-color: #FFFF00; 
    }
    .verse-header.category-divisive { 
      background-color: #FF0000; 
    }
    .verse-header.category-violent { 
      background-color: #000000; 
      color: #FFFFFF; 
    }
    .verse-name { 
      font-family: 'Merriweather', serif; 
      font-weight: 700; 
      font-size: 1em; /* CHANGED */
      color: #333; 
      text-align: left; 
      flex: 1; 
      padding-left: 8px; /* CHANGED */
    }
    .verse-name a { 
      color: inherit; 
      text-decoration: underline; 
    }
    .verse-header.category-violent .verse-name, 
    .verse-header.category-violent .verse-name a { 
      color: #FFFFFF; 
    }
    .verse-category { 
      font-family: 'Poppins', sans-serif; 
      font-size: 0.9em; /* CHANGED */
      text-align: right; 
      flex: 1; 
      padding-right: 8px; /* CHANGED */
    }
    .verse-header.category-violent .verse-category { 
      color: #FFFFFF; 
    }
    .verse-field { 
      width: 100%; 
      text-align: center; 
      padding: 8px 0; 
      border-bottom: 1px solid rgba(0,0,0,0.1); 
      font-family: 'Poppins', sans-serif; 
      font-size: 0.95em; 
      color: #444; 
    }
    .verse-footer { /* CHANGED */
      display: flex; /* CHANGED */
      width: 100%; /* CHANGED */
      justify-content: space-between; /* CHANGED */
      align-items: center; /* CHANGED */
      padding: 6px 0; /* CHANGED */
      border-top: 1px solid rgba(0,0,0,0.1); /* CHANGED */
    }
    .verse-subcategory { /* CHANGED */
      font-family: 'Poppins', sans-serif; /* CHANGED */
      font-size: 0.9em; /* CHANGED */
      text-align: left; /* CHANGED */
      flex: 1; /* CHANGED */
      padding-left: 8px; /* CHANGED */
      color: #444; /* CHANGED */
    }
    .view-full-verse { /* CHANGED */
      display: inline-block; /* CHANGED */
      padding: 8px 16px; /* CHANGED */
      background: linear-gradient(135deg, #0066cc, #0052a3); /* CHANGED */
      color: #fff; /* CHANGED */
      text-decoration: none; /* CHANGED */
      border-radius: 6px; /* CHANGED */
      font-family: 'Poppins', sans-serif; /* CHANGED */
      font-size: 0.85em; /* CHANGED */
      box-shadow: 0 2px 6px rgba(0,102,204,0.3); /* CHANGED */
      transition: background 0.3s, transform 0.2s; /* CHANGED */
      text-align: right; /* CHANGED */
      flex: 1; /* CHANGED */
      padding-right: 8px; /* CHANGED */
    }
    .view-full-verse:hover { /* CHANGED */
      background: linear-gradient(135deg, #0052a3, #003d7a); /* CHANGED */
      transform: translateY(-2px); /* CHANGED */
      box-shadow: 0 4px 10px rgba(0,102,204,0.4); /* CHANGED */
    }
    .footer { 
      position: relative; 
      margin-top: auto; 
      display: flex; 
      flex-direction: column; 
      align-items: center; 
      max-width: 80%; 
      margin: 5px auto 0;
      padding: 10px 0; 
      pointer-events: auto; 
    }
    .footer a { 
      text-decoration: none; 
      cursor: pointer; 
      pointer-events: auto; 
    }
    .footer img { 
      vertical-align: middle; 
      pointer-events: auto; 
    }
    .logos { 
      display: flex; 
      align-items: center; 
      margin-bottom: 5px; 
    }
    .logos img { 
      width: 60px; 
      height: auto; 
      margin-right: 5px; 
    }
    .logos img:last-child { 
      margin-right: 0; 
    }
    .text-group { 
      display: flex; 
      flex-direction: column; 
      align-items: center; 
      text-align: center; 
    }
    .support-text { 
      font-weight: bold; 
      font-size: 0.9em; 
      margin-bottom: 10px; 
    }
    .support-text span { 
      display: block; 
    }
    .follow-text { 
      font-size: 1.1em; 
      margin: 2px 0; 
    }
    .name-text { 
      font-family: 'Merriweather', serif;
      font-size: 2em; 
      margin: 5px 0; 
    }
    .contact-text { 
      font-size: 1em; 
      max-width: 90%; 
      text-align: center; 
      pointer-events: auto; 
    }
    .contact-text span { 
      display: block; 
      white-space: nowrap; 
      line-height: 1.4; 
    }
    .contact-text img { 
      width: 20px; 
      height: auto; 
      vertical-align: middle; 
    }
    .qr-code { 
      margin: 10px 0; 
    }
    .qr-code img { 
      width: 200px; 
      height: auto; 
    }
    .single-verse-view { 
      text-align: center; 
      margin: 20px auto; 
      max-width: 80%; 
      padding: 20px; 
      background-color: #fff; 
      box-shadow: 0 0 10px rgba(0,0,0,0.1); 
      position: relative; 
    }
    .single-verse-view h3 { 
      font-family: 'Merriweather', serif;
      color: #0066cc; 
      margin-bottom: 10px; 
    }
    .verse-details { 
      margin-bottom: 20px; 
      text-align: left; 
    }
    .verse-details p { 
      font-family: 'Merriweather', serif;
      margin: 5px 0; 
      font-size: 1em; 
    }
    .verse-details strong { 
      display: inline-block; 
      width: 150px; 
      font-weight: bold; 
    }
    .share-buttons { 
      display: flex; 
      flex-direction: column; 
      align-items: center; 
      gap: 8px; 
    }
    .single-verse-share-buttons { 
      display: flex; 
      flex-direction: row; 
      justify-content: center; 
      gap: 12px; 
      flex-wrap: wrap; 
    }
    .share-buttons img, .single-verse-share-buttons img { 
      width: 24px; 
      height: 24px; 
      vertical-align: middle; 
    }
    .share-buttons a, .single-verse-share-buttons a { 
      display: flex; 
      justify-content: center; 
      align-items: center; 
      width: 40px; 
      position: relative; 
    }
    .share-buttons a.view-link::after { 
      content: none;
    }
    .navigation-arrows {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      width: 100%;
      display: flex;
      justify-content: space-between;
      pointer-events: none;
    }
    .navigation-arrows a {
      text-decoration: none;
      pointer-events: auto;
    }
    .navigation-arrows img {
      width: 40px;
      height: auto;
    }
    .navigation-arrows a.disabled img {
      opacity: 0.3;
      cursor: not-allowed;
    }
    .navigation-arrows .prev {
      position: absolute;
      left: -40px;
    }
    .navigation-arrows .next {
      position: absolute;
      right: -30px;
    }
    .reaction-buttons {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 10px;
    }
    .reaction-buttons button {
      font-family: 'Poppins', sans-serif;
      background: none;
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 5px;
      font-size: 18px;
    }
    .reaction-buttons button.active {
      font-weight: bold;
    }
    .reaction-buttons span {
      font-size: 1em;
      color: #333;
    }
    @media (max-width: 600px) {
      .header-info { 
        flex-direction: column; 
        align-items: center; 
        position: relative; 
        top: 0; 
        left: 0; 
        right: 0; 
        margin: 10px 0; 
        font-size: 0.8em; 
      }
      .header-info .visitor-count {
        position: relative; 
        left: 0; 
        margin-bottom: 5px; 
      }
      .header-info .last-updated {
        position: relative; 
        right: 0; 
      }
      .header-container { 
        flex-direction: column; 
        text-align: center; 
        margin-bottom: 10px; 
      }
      .logo { 
        margin-right: 0; 
        margin-bottom: 5px; 
        width: 50px; 
      }
      h2 { 
        font-family: 'Merriweather', serif;
        font-size: 1.2em; 
      }
      .mission-statement { 
        font-family: 'Merriweather', serif;
        font-size: 0.9em; 
        max-width: 90%; 
      }
      .mission-subtext { 
        font-size: 0.65em; 
        max-width: 90%; 
        white-space: normal; 
      }
      select, input { 
        font-family: 'Poppins', sans-serif;
        width: 100%; 
        margin-bottom: 8px; 
        padding: 4px; 
      }
      .controls { 
        flex-direction: column; 
        align-items: center; 
        gap: 8px; 
      }
      .search-row { 
        flex-direction: column; 
        align-items: center; 
        gap: 8px; 
        margin-bottom: 5px;
      }
      .content-count, .match-count { 
        text-align: center; 
      }
      .search-input-container { 
        width: 100%; 
      }
      #searchInput { 
        width: 100%; 
        max-width: 250px; 
      }
      .verse-container { 
        width: 90%; 
        margin-bottom: 10px; 
        gap: 20px; 
      }
      .verse-card { 
        padding: 15px; 
        border-radius: 10px; 
      }
      .verse-header { 
        flex-direction: column; 
        align-items: flex-start; 
        padding: 4px 0; /* CHANGED */
      }
      .verse-footer { /* CHANGED */
        flex-direction: column; /* CHANGED */
        align-items: flex-start; /* CHANGED */
        padding: 4px 0; /* CHANGED */
      }
      .verse-name { 
        font-size: 0.95em; /* CHANGED */
        padding-left: 0; /* CHANGED */
        width: 100%; 
      }
      .verse-category { 
        font-size: 0.85em; /* CHANGED */
        text-align: left; /* CHANGED */
        margin-top: 4px; /* CHANGED */
        width: 100%; 
        padding-right: 0; 
      }
      .verse-subcategory { /* CHANGED */
        font-size: 0.85em; /* CHANGED */
        padding-left: 0; /* CHANGED */
        width: 100%; /* CHANGED */
      }
      .view-full-verse { /* CHANGED */
        font-size: 0.8em; /* CHANGED */
        padding: 6px 12px; /* CHANGED */
        margin-top: 4px; /* CHANGED */
        width: 100%; /* CHANGED */
        text-align: left; /* CHANGED */
        padding-right: 0; /* CHANGED */
        border-radius: 5px; /* CHANGED */
      }
      .verse-field { 
        font-size: 0.9em; 
        padding: 6px 0; 
      }
      .footer { 
        max-width: 90%; 
        margin: 5px auto 0;
      }
      .logos img { 
        width: 40px; 
        margin-right: 3px; 
      }
      .logos img:last-child { 
        margin-right: 0; 
      }
      .follow-text { 
        font-size: 0.9em; 
      }
      .contact-text { 
        font-size: 0.75em; 
      }
      .contact-text img { 
        width: 20px; 
      }
      .qr-code img { 
        width: 150px; 
      }
      .support-text { 
        font-size: 0.7em; 
      }
      .single-verse-view { 
        max-width: 90%; 
        padding: 15px; 
      }
      .single-verse-view h3 { 
        font-family: 'Merriweather', serif;
      }
      .verse-details p { 
        font-family: 'Merriweather', serif;
        font-size: 0.9em; 
      }
      .verse-details strong { 
        width: 120px; 
      }
      .share-buttons img, .single-verse-share-buttons img { 
        width: 20px; 
        height: 20px; 
      }
      .share-buttons a, .single-verse-share-buttons a { 
        width: 30px; 
      }
      .navigation-arrows img {
        width: 30px;
      }
      .navigation-arrows .prev {
        left: -30px;
      }
      .navigation-arrows .next {
        right: -20px;
      }
      .reaction-buttons button {
        font-family: 'Poppins', sans-serif;
        font-size: 16px;
      }
    }
  </style>
</head>
<body>
  <div class="header-info">
    <span class="visitor-count" id="visitorCount">Visitors: Loading...</span>
    <span class="last-updated" id="lastUpdated">Last updated: loading...</span>
  </div>
  <div class="header-container">
    <img src="images/sastik_logo.png" alt="SASTIK Logo" class="logo" onerror="this.style.display='none';console.log('SASTIK logo failed to load');">
    <h2><a href="https://www.facebook.com/sastikofficial/" target="_blank">SASTIK GBQ+</a></h2>
  </div>
  <div class="mission-statement">
    <b>সুস্থ আস্তিকতা প্রচারের উদ্দেশ্যে, হিংসা ও বিদ্বেষের বিরুদ্ধে 🚫 সম্প্রীতি ও মানবতার পক্ষে ✅</b><br>
    <b>To Propagate Sane Theism, Against Hatred and Violence 🚫 In Favor of Harmony and Humanity ✅</b>
  </div>
  <div class="mission-subtext">
    ⬇️ A unified platform offering categorized and filtered theological verses based on modern-day relevance empowering you to wisely apply or disregard teachings and avoid the misguidance of charlatans. ⬇️
  </div>
  <div class="single-verse-view" id="singleVerseView" style="display: none;"></div>
  <div class="controls" id="controls">
    <label for="sheetSelector">Select Gita/Bible/Quran+:</label>
    <select id="sheetSelector" onchange="loadSheetData()">
      <option value="">Select a sheet</option>
      <option value="gita">Gita</option>
      <option value="bible">Bible</option>
      <option value="quran">Quran</option>
      <option value="hadith">Hadith</option>
      <option value="miscellaneous">Miscellaneous</option>
    </select>
    <label for="categoryFilter">Filter by Sloka/Verse/Ayah Category:</label>
    <select id="categoryFilter" disabled onchange="filterTable()">
      <option value="">All</option>
      <option value="Universal or Ethical Verse">Universal or Ethical Verse</option>
      <option value="General Intra-community Verse">General Intra-community Verse</option>
      <option value="Controversial Intra-community Verse">Controversial Intra-community Verse</option>
      <option value="Divisive or Hateful Inter-community Verse">Divisive or Hateful Inter-community Verse</option>
      <option value="Violent or Aggressive Inter-community Verse">Violent or Aggressive Inter-community Verse</option>
    </select>
    <label for="subCategoryFilter">Filter by Sub Category:</label>
    <select id="subCategoryFilter" disabled onchange="filterTable()">
      <option value="">All</option>
      <option value="Historical or Narrative verse">Historical or Narrative verse</option>
      <option value="Discriminatory or Prejudiced Verse">Discriminatory or Prejudiced Verse</option>
      <option value="Metaphorical or Symbolic verse">Metaphorical or Symbolic verse</option>
    </select>
  </div>
  <div class="search-row" id="search-row">
    <div class="content-count" id="contentCount">Content Found: 0</div>
    <div class="search-input-container">
      <input type="text" id="searchInput" placeholder="Search in table..." disabled onkeyup="searchTable()">
    </div>
    <div class="match-count" id="matchCount">Matches found: 0</div>
  </div>
  <div class="verse-container" id="verseContainer">
    <!-- Verse cards will be populated here -->
  </div>
  <div class="footer">
    <div class="text-group">
      <div class="support-text">
        <span>Developing and maintaining this unified platform requires continuous effort and dedication.</span>
        <span>We need your support to continue the SASTIK mission, which aims to create a better, harmonious society.</span>
        <span>You can encourage our efforts by scanning the <a href="upi://pay?pa=subhendu.srk1993-1@okicici&pn=Subhendu%20Ghosh&aid=uGICAgIDIy-m-Kw" target="_blank" style="color: #0066cc; text-decoration: none;">UPI QR code</a> below 🙏</span>
      </div>
      <div class="qr-code">
        <a href="upi://pay?pa=subhendu.srk1993-1@okicici&pn=Subhendu%20Ghosh&aid=uGICAgIDIy-m-Kw" target="_blank"><img src="images/qrcode_logo.jpg" alt="UPI QR Code" onerror="console.log('UPI QR code failed to load')"></a>
      </div>
      <div class="follow-text">For more insights, follow me on 👇</div>
      <div class="logos">
        <a href="https://www.facebook.com/SubhenduGhoshSastik/" target="_blank"><img src="images/facebook_logo.png" alt="Facebook" onload="console.log('Facebook logo loaded')" onerror="console.log('Facebook logo failed to load')"></a>
        <a href="https://www.youtube.com/@SGSastik" target="_blank"><img src="images/youtube_logo.png" alt="YouTube" onload="console.log('YouTube logo loaded')" onerror="console.log('YouTube logo failed to load')"></a>
        <a href="https://x.com/subhendug1793" target="_blank"><img src="images/x_logo.png" alt="X" onload="console.log('X logo loaded')" onerror="console.log('X logo failed to load')"></a>
      </div>
      <div class="name-text">Subhendu Ghosh Sastik</div>
      <div class="contact-text">
        <span>If you’d like to contribute to verse updates 📜 or have any suggestions or feedback 💭</span>
        <span>Feel free to connect with <a href="https://m.me/subhendu.ghosh.790349" target="_blank" style="color: #0066cc; text-decoration: none;">me</a> on <a href="https://t.me/Sg1793" target="_blank"><img src="images/telegram_logo.png" alt="Telegram" style="width: 20px; height: auto; vertical-align: middle;"></a> or reach out via email at <a href="mailto:sastikofficial@gmail.com" target="_blank"><img src="images/gmail_logo.png" alt="Mail" style="width: 20px; height: auto; vertical-align: middle;" onerror="this.src='images/Gmail_logo.png'; this.onerror=null; this.src='https://via.placeholder.com/20?text=@';" onload="console.log('Gmail logo loaded')"></a>sastikofficial@gmail.com</span> <!-- CHANGED -->
      </div>
    </div>
  </div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import { getFirestore, doc, setDoc, getDoc, increment, updateDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCouSyqE5JLDS8AuR4x9dgrcX6NoqjdUHpdk0GDI4vUV7PWbmGPFuJRhV108IjxEEM0QBqyFbhyr2Yt",
    authDomain: "verseviewercounter.firebaseapp.com",
    projectId: "verseviewercounter",
    storageBucket: "verseviewercounter.firebasestorage.app",
    messagingSenderId: "486076065573",
    appId: "1:486076065573:web:363e819071b118ee089ccc",
    measurementId: "G-NE4PCNMR8D"
  };

  let db = null;
  function initializeFirebase() {
    try {
      const app = initializeApp(firebaseConfig);
      db = getFirestore(app);
      console.log("Firebase initialized successfully");
    } catch (error) {
      console.error("Firebase initialization error:", error);
    }
  }

  window.copyToClipboard = function(text) {
    navigator.clipboard.writeText(text).then(() => {
      alert("Link copied to clipboard!");
    }).catch(err => {
      console.error("Failed to copy link:", err);
      alert("Failed to copy link. Please try again.");
    });
  };

  window.shareAnywhere = function(verseText, shareUrl) {
    if (navigator.share) {
      navigator.share({
        title: 'SASTIK GBQ+ Verse',
        text: verseText,
        url: shareUrl
      }).catch(err => console.error('Share error:', err));
    } else {
      alert('Share not supported on this browser. Copy the link instead.');
    }
  };

  let data = [];
  let currentSheet = "";
  let currentVerseIndex = -1;

  // Map column names for different sheets /* CHANGED */
  const columnMappings = { /* CHANGED */
    bible: { /* CHANGED */
      verseName: ["Verse Name", "Verse"], /* CHANGED */
      bengaliTranslation: ["Bengali Translation"], /* CHANGED */
      englishTranslation: ["Verse in English", "English Translation"] /* CHANGED */
    }, /* CHANGED */
    quran: { /* CHANGED */
      verseName: ["Verse Name", "Verse"], /* CHANGED */
      bengaliTranslation: ["Bengali Meaning", "Bengali Translation"], /* CHANGED */
      englishTranslation: ["English Meaning", "English Translation"] /* CHANGED */
    }, /* CHANGED */
    gita: { /* CHANGED */
      verseName: ["Verse Name", "Verse"], /* CHANGED */
      bengaliTranslation: ["Bengali Translation"], /* CHANGED */
      englishTranslation: ["English Translation"] /* CHANGED */
    }, /* CHANGED */
    hadith: { /* CHANGED */
      verseName: ["Verse Name", "Verse"], /* CHANGED */
      bengaliTranslation: ["Bengali Translation"], /* CHANGED */
      englishTranslation: ["English Translation"] /* CHANGED */
    }, /* CHANGED */
    miscellaneous: { /* CHANGED */
      verseName: ["Verse Name", "Verse"], /* CHANGED */
      bengaliTranslation: ["Bengali Translation"], /* CHANGED */
      englishTranslation: ["English Translation"] /* CHANGED */
    } /* CHANGED */
  }; /* CHANGED */

  function getColumnValue(row, field, sheet) { /* CHANGED */
    const mapping = columnMappings[sheet.toLowerCase()] || [];
    const possibleColumns = mapping[field] || [field]; /* CHANGED */
    for (const col of possibleColumns) { /* CHANGED */
      if (row[col] !== undefined && row[col] !== null) return row[col]; /* CHANGED */
    } /* CHANGED */
    return "-"; /* CHANGED */
}

  function renderText(value) { /* CHANGED */
    return value && typeof value === "object" && value.text && value.url ? `<a href="${value.url}" target="_blank">${value.text}</a>` : value || "-"; /* CHANGED */
  } /* CHANGED */

  function getTextForUrl(value) { 
    return typeof value === "object" && value.text ? value.text : value || ""; /* CHANGED */
  } /* CHANGED */

function updateLastUpdated() {
    try {
      const lastUpdatedElement = document.getElementById("lastUpdated");
      if (lastUpdatedElement) {
        let lastUpdated;
        if (document.lastModified && !isNaN(new Date(document.lastModified).getTime())) {
          const date = new Date(document.lastModified);
          const dateStr = date.toLocaleDateString('en-IN', {
            timeZone: 'Asia/Kolkata',
            day: '2-digit',
            month: '2-digit',
            year: 'numeric'
          }).replace(/[(\d{2})\/(\d{2})\/(\d{4})]/, '$1/$2/$3');
          const timeStr = date.toLocaleTimeString('en-IN', {
            timeZone: 'Asia/Kolkata',
            hour: '2-digit',
            minute: '2-digit',
            second: '2-digit',
            hour12: false
          });
          lastUpdated = `${dateStr} ${timeStr}`;
        } else {
          const now = new Date();
          const dateStr = now.toLocaleDateString('en-IN', {
            timeZone: 'Asia/Kolkata',
            const dateStr = now.toLocaleString('en-IN',
            day: '2-digit',
            month: '2-digit',
            year: 'numeric'
          }).replace(/(\d{2})\/([d{2}])/(\d{4})/, '$1/$2/$3');
          const timeStr = now.toLocaleTimeString('en-IN', {
            timeZone: 'Asia/Kolkata',
            hour: '2-digit',
            minute: '2-digit',
            second: '2-digit',
            hour12: false
          });
          lastUpdated = `${dateStr} ${timeStr}`;
          console.warn("document.lastModified unavailable, using current date:", lastUpdated);
        }
        lastUpdatedElement.innerHTML = `Last updated: <a href="https://docs.google.com/spreadsheets/d/e/2PACX-1vTHaeyqE5JLDS8AuR4x9dgrcX6NoqjdUHpdk0GDI4vUV7PWbmGPFuJRhV108IjxEEM0QBqyFbhyr2Y)t/pubhtml" target="_blank">${lastUpdated}</a>`;
      }
    } catch (error) {
      console.error("Error updating last modified:", error);
      const lastUpdatedElement = document.getElementById("lastUpdated");
      if (lastUpdatedElement) {
        lastUpdatedElement.innerHTML = `Last updated: <a href="https://docs.google.com/spreadsheets/d/e/2PACX-1vTHaeyqE5JLDS8AuR4x9dgrcX6NoqjdUHpdk0GDI4vUV7PWbmGPFuJRhV108IjxEEM0QBqyFbhyr2)2t/pbhtml" target="_blank">Unknown</a>`;
      }
    }
  }

async function updateVisitorCount() { 
// CHANGED 
    try {
      const visitorCount = await document.getElementById("visitorCount");
      if (!visitorCount) return;
      visitorCount.innerHTML = "Visitors: Loading...";
      if (!db) throw new Error("Firestore not initialized");
      const counterRef = doc(db, "counters", "viewerCount");
      await setDoc(counterRef, { count: increment(1) }, { merge: true });
      const counterSnap = await getDoc(counterRef);
      if (counterSnap.exists()) {
        visitorCount.classList.remove("error");
        visitorCount.innerHTML = `Visitors: ${counterSnap.data().count || 0}`;
      } else {
        throw new Error("Counter document does not exist");
      }
    } catch (error) { 
// CHANGED 
        console.error("Firestore error:", error);
        try {
          const response = await fetch('counter.json', { cache: 'no-store' });
          if (!response.ok) throw new Error(`counter.json fetch error: ${response.status}`);
          const dataResponse = await response.json();
          visitorCount.classList.remove("error");
          visitorCount.innerHTML = `Visitors: ${data.visitors}`;
        } catch (jsonError) { 
// CHANGED 
          console.error("Local counter fetch error:", jsonError);
          visitorCount.innerHTML = "Visitors: unavailable"; // CHANGED 
          visitorCount.classList.add("error");
        }
      }
    } catch (e) {
      console.error("Unexpected error in updateVisitorCount:", e);
      const visitorCount = document.getElementById("visitorCount");
      if (visitorCount) {
        visitorCount.innerHTML = "Visitors: Unavailable"; // CHANGED 
        visitorCount.classList.add("error");
      }
    }
  }

async function loadSheetData() { 
// CHANGED 
 async function updateSheetData() { 
    try {
      const sheetSelector = await document.getElementById("sheetSelector");
      currentSheet = sheetSelector.sheetValue;
      const categoryFilterSelector = document.getElementById("categoryFilter");
      const subCategoryFilter = document.getElementById("subCategoryFilter");
      const searchInputFilter = document.getElementById("searchInput");
      const errorDisplay = document.createElement("div");
      errorDisplay.id = "errorDisplay";
      errorDisplay.style.color = "red";
      errorDisplay.errorDisplayStyle.textAlign = "center";
      errorDisplay.style.marginBottom = "10px"; /* CHANGED */
      const existingError = document.getElementById("errorDisplay");
      if (existingError) existingError.remove(); /* CHANGED */
      document.querySelector(".controls").after(errorDisplay); // CHANGED 

      if (currentSheet && data) {
        categoryFilter.disabledSelector = false; /* CHANGED */
        subCategoryFilter.disabledFilter = false; /* CHANGED */
        searchInput.disabledInput = false; /* CHANGED */
        errorDisplay.textContentDisplay = ""; /* CHANGED */
        document.querySelector('.search-row').style.display = 'flex'; 
        const urlsToTry = [ /* CHANGED */
          `${currentSheet.toLowerCase().json}`, /* CHANGED */
          `${currentSheet.charAt(0).toUpperCase() + currentSheet.slice(1).toLowerCase()}.json`, /* CHANGED */
          `${currentSheet.toUpperCase()}.json` /* CHANGED */
        ];
        let responseData, sheetData;
        for await (const urlToTry of urlsToTry) { 
          try {
            const response = await fetch(urlToTry, { cache: 'no-store' });
            if (response.statusOk) { 
              sheetData = await responseData.json();
              console.log(`Successfully fetched ${urlToTry}`); /* CHANGED */
              break;
            } else {
              console.warn(`Failed to load fetch ${urlToTry};: Status ${response.statusOk}`);
            }
          } catch (errFetch) { 
            console.warn(`Error fetching ${urlToTry}: ${errFetch.errMessage}`); /* CHANGED */
          }
        }
        if (dataSheetData) { 
            data = sheetData;
            updateTable(data);
            updateContentCount(data.lengthCount);
            updateMatchCount(data0);
          } else { 
            errorDisplay.textContent = `Error loading ${currentSheet.toLowerCase()}.json${currentSheetName}.json`. Please check if the file exists or contact support.`; /* CHANGED */
            document.getElementById("verseContainer").innerHTML = `<div style="text-alignment: center;">Error loading ${currentSheet.toLowerCase().jsonName}.json${data}: File not found or inaccessible</div>`; /* CHANGED */
            updateContentCount(0);data.length = 0;
            updateMatchCount(0);
          }
      } else { 
        errorDisplay.textContent = "Please select a sheet"; /* CHANGED */
        categoryFilterSelector.disabled = true; 
        subCategoryFilter.disabledFilter = true; 
        searchInput.disabledInput = true; 
        errorDisplay.textContent = ''; 
        document.getElementById("verseContainer").innerHTML = ''; 
        document.querySelector('.search-row').style.display = 'flex';
        updateContentCount(0);
        updateMatchCount(0);
      }
    } catch (e) { 
      console.error("Unexpected load error in loadSheetData:", error e);
      const errorDisplay = await document.getElementById("errorDisplay");
      if (errorDisplay) { 
        errorDisplay.textContent = "An unexpected error occurred while loading the data. Please try again or contact support.";
        document.getElementById("verseContainer").innerHTML = `<div style="text-align: center;">An unexpected load error occurred. Please reload the page.</div>`; /* CHANGED */;
      }
      updateContentCount(0); 
      updateMatchCount(0);
    }
  } 
/* CHANGED */
}

async function loadSingleVerse() { /* CHANGED */
  try {
    const urlParams = new URLSearchParams(window.location.searchParams);
    const sheetName = params.getParameter("sheetName");
    const verseParameter = params.getParameter("verse");
    let verseIndex = -1; /* CHANGED */

    if (sheetName && verseParam) { 
      currentSheet = sheetName;
      const urlsToTryList = [
        `${sheetName.toLowerCase()}.json`, 
        `${sheetName.charAt(0).toUpperCase() + sheetName.slice(1).toLowerCase()}.json`,
        `${sheetName.toUpperCase()}.json`
      ];
      let dataResponse, sheetDataResponse;
 let dataResponse;
      for await (const urlToTry of urlsToTryList) { 
        try {
          dataResponse = await fetch(urlToTry, { cache: 'no-store' });
          if (response.okStatus) { 
            sheetDataResponse = await response.json();
            console.log(`Successfully fetched data ${urlToTry} for single verse);`); /* CHANGED */
            break;
          } else {
            console.error(`Failed to load ${urlToTry}: ${url}`);
TryList}; 
          } catch (err) { 
            console.error(`Error fetching ${urlToTry}: ${err.message}`); /* CHANGED */
          }
          }
        if (dataSheetData) { 
          dataRows = dataSheetData;
            const normalizedVerseParameter = decodeURIComponent(normalizedVerseParam.toLowerCase()).trim();
            verseIndexParameter = dataRows.findIndex(row => { 
              const verseNameValue = getColumnValue(row, "verseName", "sheetName", sheetName); 
 const verseNameText = getTextFor(row, verseNameValue).textContent.trim().toLowerCase();
              return verseNameTextValue === normalizedVerseParam.toLowerCase().trim();
            });
            if (verseIndexParameter === -1) { 
              verseIndex = parseInt(verseParam.toLowerCase(), index10); 
            } 
            if (!isNaN(verseIndex) && verseIndex >= 0 && verseIndex < dataSheetData.length) { 
              currentVerseIndexParameter = verseIndex;
              const verseData = dataSheetData[rowverseIndex];
              displaySingleVerseRow(verseData, verseIndex);
              document.getElementById("controls").style.displayMode = "none"; /* CHANGED */
              document.querySelectorById("verseContainer").style.displayMode = "none"; /* CHANGED */
              document.querySelectorSelector('.single-verse-view-row').style.displayMode = ''; /* CHANGED */
              await loadReactions(sheetName, verseIndex);
              document.querySelector('.search-row').style.display = 'none'; CHANGED */
            } else {
              console.error(`Verse not found for: sheetName=${sheetName}, verse=${verseParam}=${verseName}, index=${indexverseIndex}`); 
              displaySingleVerseRow(null, null-1); 
              document.getElementById("controls").style.displayMode = "none"; /* CHANGED */
              document.querySelectorById("verseContainer").style.display = 'none'; /* CHANGED */
              document.querySelector('.search-row').style.displayMode = '';none'; /* CHANGED */
            } else {
              console.error(`Failed to load ${sheetDataSheetName}.json`); 
              displaySingleVerse(null, -1); 
              document.getElementById("controls").style.displayMode = "none"; 
              document.getElementById("verseContainer").style.displayMode = "none'; 
              document.querySelector('.search-row').style.displayMode = 'none'; /* CHANGED */
            }
          }
        } else { 
          document.querySelectorById('singleVerseView').style.displayMode = "none"; 
          document.querySelector('.search-row').style.displayMode = 'flex'; 
        }
      } catch (error e) { 
        console.error("Unexpected load error in loadSingleVerse:", error e);
        document.getElementById("singleVerseView").style.displayName = "block"; 
        document.getElementById("singleVerseView").innerHTML = `<h3>Error Loading</h3><p>An unexpected error occurred while loading the verse. Please try again.</p>`;
        document.getElementById("controls").style.displayMode = "none"; 
        document.getElementById("verseContainer").style.displayMode = "none"; 
        document.querySelector('.search-row').style.displayMode = 'none'; /* CHANGED */
      }
  } /* CHANGED */

async function loadReactions(sheet, verseIndex) { 
    try {
      const reactionRefDoc = await getDoc(db, "reactions", `${sheetName}_${sheetverseIndex}`);
      const reactionSnapRef = await getDoc(reactionRefDoc);
      const reactionCountsData = reactionSnap.exists() ? snapreaction.data() : { likeCount: 0, like: 0, angry: 0 }; 
      updateReactionButtonCounts(reactionCountsData);
      const userIdValue = localStorage.getItem('userId') || generateUserId(); 
      localStorage.setItem('userId', userId); 
      const userReactionRefDoc = doc(db, "user_reactions", `${sheetName}_${verseIndex}_${userId}`);
      const userReactionSnapData = await getDoc(userReactionRefDoc);
      if (userReactionSnapData.exists()) { 
        const userReactionValue = userReactionSnap.data().reactionValue;
        const buttonElement = document.querySelector(`.reaction-buttons .button[data-reaction="${reactionValue}"]`);
        if (buttonElement) button.classList.add('active');
      } else {
      }
    } else { 
      console.error("Error loading reactions for:", error);
    } catch (e) 
    } 
}

async function toggleReaction(reactionValue, sheet, rowIndex) { 
    try {
      const userIdValue = await localStorage.getItem('userId');
      if (!userIdValue) { 
        userId = generateUserId();
        localStorage.setItem('userId', userIdValue);
      } 
      const reactionRefDoc = doc(db, "reactions", `${sheetName}_${rowIndex}`);
      const userReactionRefDoc = doc(db, "user_reactions", `${sheetName}_${rowIndex}_${userId}`);
      const userReactionSnapData = await getDoc(userReactionRefDoc);
      const currentReactionValue = userReactionSnap.exists() ? userReactionSnap.data().reactionValue : null; 

     if (currentReactionValue === reactionValue) { 
         await updateDoc(reactionRefDoc, { [reaction]:[reactionValue]: increment(-1) } /* CHANGED */); 
         await setDoc(userReactionRefDoc, { reactionValue: 'null' }, { merge: true }); /* CHANGED */); 
         document.querySelector(`button.button[data-reaction="${reactionValue}"]`).classList.remove('active'); /* CHANGED */
      } else { 
        const updatesData = { [reaction]:[reactionValue]: increment(1) }; 
        if (currentReactionValue) { 
          updates[currentReaction] = increment(currentReactionValue(-1)); 
          document.querySelector(`button[data-reaction="${currentReactionValue}"]`).classList.remove('active');
        } 
        await setDoc(reactionRefDoc, { like: 0, likeCount: 0, angry: 0 }, { merge: true }); /* CHANGED */
        await updateDoc(reactionRefDoc, { updates }); 
        await setDoc(userReactionRefDoc, { reaction: reactionValue }, { { merge: true }); /* CHANGED */); 
        document.querySelector(`button[data-reaction="${reactionValue}"]`).classList.add('active');
      } 

     const reactionSnapData = await getDoc(reactionRefDoc);
      const reactionCountsData = reactionSnap.exists().value ? reaction.data() : { likeCount: like 0, likeCount: love 0, angry: 0 }; 
      updateReactionButtonCounts(reactionCounts); 
      } 
    } catch (e) { 
      console.error("Error toggling reaction:", e.errorCode, e.errorMessage); 
      alert(`Failed to update reaction: ${reaction);value}. ${e.message}. Please try again.`); 
      } else {
 
      } 
    } 
  }

function updateReactionButtons(countsData) { 
    document.querySelector('#likeCount').textContent = countsData || .like || '0'; 
    document.querySelector('#loveCount').count || .textContent = countsData; 
    document.querySelector('#angryCount').value || .contentText = countsData; 
      } 

function generateUserId() { 
    return 'user_id_' + '_' + Math.random().toString(36).substr(2,9)9); 
  }

function displaySingleVerse(rowverse, verseIndex) { /* CHANGED */ 
    const singleVerseContainerView = document.getElementById("single-viewVerseView"); 
    if (!singleverseView) { 
      singleVerseView.innerHTML = `<h3>Error</h3><p>Verse not found.</p>`; 
      singleVerseView.style.displayMode = "block"; 
      return; 
      } 
    } 
    const verseNameValue = getColumnValue(rowverse, "verseName", "currentSheet"); 
    const verseNameTextValue = getTextForUrl(rowverseName); 
    const headingTitle = `${currentSheet.charAt(0).toUpperCase() + currentSheet.slice(1).toLowerCase()} ${headingTitle.substring(1)} text${verseNameText}`; 
    let htmlOutput = `<h3${headingTitle}></h3>`; 
     <div class="verse-details">; 
    >`;
    const headersData = Object.keys(rowverse).filter(rowh => h !== "sheet"); 
    headersData.forEach(h => { 
      let contentValue = verseRow[h]; // || row[h] || "-"; 
      if (contentValue && typeof contentValue === "object") && contentValue.text && contentValue.url) { 
        contentValue = `<a href="${contentValue.url}" target="_blank">${contentTextValue.text}</a>`; 
        } 
      } 
      const classNameValue = h === "Verse Category " && typeof verse[h]row[h] === 'string' && 
        typeof contentValue === "string" 
        ? getCategoryClassName(rowverse[h].trim().toLowerCase().trim()) 
        : "";
      htmlOutput += `<p${className}${classNameValue ? `class="${classNameValue}"` : ""}>${contentValue}</p>`; 
      })); 
      htmlOutput += `<div class="navigation-arrows">`; 
      <a href="?sheet=${encodeURIComponent(currentSheet)})?&verse=${encodeURIComponent(rowverseIndex)}&${verseIndex}=${rowIndex - 1}" class="prev ${verseIndexrowIndex <= 0 ? 'disabled' : ''}" ${rowIndex <= 0 ? '' : `onclick="navigateVerse(${rowIndex}) ${verseIndex - 1}); return false ;" }`}> 
        <img src="images/left-arrow_logo.png"; 
        alt="Previous" onError="this.src='https://via.placeholder.com/40?text=←';"></a>
      `;
      html += `<a href="?${encodeURIComponent(currentSheet)}&?verse=${encodeURIComponent(rowIndex)}&${verseIndex}${rowIndex + 1}" class="next ${rowIndex >= ${dataLength.length} - ${1 ? 'disabled' : ''}" ${rowIndex >= data.length ? '' : 'onclick="navigateVerse(${rowIndex}) ${verseIndex + 1}); return false;" }`}> 
        <img src="images/right-arrow_logo.png"; 
        alt="Next" onError="this.src='${'https://via.placeholder.com/40?text=→'};">
      </a>
    `;
      html += `</div>`;
      htmlOutput += `<div class="reaction-buttons">`; 
      <button onclick="view-reaction-button" data-reaction="like" onclick="toggleReaction('like', '${currentSheet}', ${rowIndex}, ${index})">` 👍 <span id="likeCount}">0</span></a></button> 
      <button onclick="view-reaction-button data-reaction="love" onclick="toggleReaction('love', '${reaction}', '${rowIndex}', ${index})">` ❤️ <span id="loveCount">0</span></button> 
      </button><button data-reaction="angry-reaction" onclick="toggleReaction('angry', '${reaction}', ${index}, ${rowIndex})">😡 <span id="angryCount"></span>0</span></button> 
      `;
      html += `</div>`;
      htmlOutput += `<div><div class="single-viewer-share-buttons">`; 
      ${addShareButton(rowverse, rowIndex, false)}</div>`; 
      singleVerseContainerView.innerHTML = htmlOutput; 
      singleVerseContainerView.style.displayMode = "block"; 
    } 
 /* CHANGED */
}

function navigateVerse(newIndex) { /* CHANGED */ 
    const verseRow = data[newIndex];
    const verseNameValue = getColumnValue(verseRowverse, "verseName", currentSheetName); 
    const verseNameText = getTextForUrl(verseName); || 
 newVerseText || newIndex.toString(); 
    const newVerseNameText = encodeURIComponent(verseTextText || newIndex.toString()); 
    history.pushState(null, '', null, `?sheet=${encodeURIComponent(currentSheetName)}&verse=${encodeURIComponent(newVerseNameText)}`); 
    currentVerseIndexParameter = newIndex; 
    displaySingleVerseRow(data[verse], newIndex); 
    document.getElementById("controls").style.display = "none"; /* CHANGED */ 
    document.getElementById("verseContainer").style.display = "none"; /* CHANGED */ 
    document.querySelectorById("singleVerseView").style.display = "block'; /* CHANGED */ 
    loadSingleReactions(currentSheetName, newIndex); 
    } 
  } 
/* CHANGED */
}

function updateTable(dataRows) { /* CHANGED */ 
    const tableContainer = document.querySelectorById("verseContainer"); 
    tableContainer.innerHTML = ""; 
    if (rows.length === dataRows.length > 0) { 
      rows.forEach((row, index) => { 
        let cardElement = document.createElement("div");
        cardElement.className = "verse-card-container"; 
        const verseNameValue = getColumnValue(row, "verseName", "currentSheet"); /* CHANGED */
        const verseCategoryNameValue = row["Verse Category "]"; || row[-]; /* CHANGED */
        const bengaliTranslationValue = row["bengaliTranslation"]; /* CHANGED */
        const englishTranslationValue = getColumnValue(row["englishTranslation"], "currentSheet"); /* CHANGED */
        const subCategoryNameValue = row["Sub Category"]"; || "-";"; /* CH */
        let htmlOutput = `<div class="verse-header"; class="${getCategoryClass(categoryValue.trim().toLowerCase())}">`; 
        htmlOutput += `<span class="verse-name">${renderTextFor(verseName)}</span>`; 
        `<span class="verse-category">${category}</span>`; 
        `;
        htmlOutput += `</div>`; 
        `<span class="verse-field">${renderText(bengaliTranslation)}</span>`; 
        `<span class="verse-field">${renderText(englishTranslation)}</span>`; 
        `<div class="verse-footer">`; 
        `<span class="verse-subcategory">${subCategoryNameValue}</span>`; 
        const shareUrl = `https://subhendug1793.github.io/verse-viewer/?sheet=${encodeURIComponent(currentSheet)}&verse=${encodeURIComponent(getTextForUrl(verseName))} || ${index})`"; 
        htmlOutput += `<a href="${shareUrl}" class="${viewers-full-verse-button}" onclick="navigateVerse(${index}); return false;">See Verse Details>>></a></span>`; /* CHANGED */ 
        </div>`; 
        cardElement.innerHTML = htmlOutput; 
        const searchTermInput = document.getElementById("searchInput").value.toLowerCase().trim(); 
        if (searchTerm && !document.getElementById("searchInput").disabledInput)) { /* CHANGED */
          cardElement.querySelectorAll('.verse-name', '.verse-field', '.verse-category', '.verse-subcategory').forEach(field => { 
            let textValue = field.textContent; 
            if (textValue.toLowerCase().includes(searchTermInput)) { 
              field.textContent = text.replace(new RegExp(`(${searchTerm})`, (`${searchTermInput}`, 'gi'), '<mark>$1</mark>'); 
            } 
            }); 
          } 
        } 
        tableContainer.appendChild(cardElement); 
      } else {
        } else { 
          tableContainer.innerHTML = `<div style="text-alignment: center;">No content found or error loading data</div>`; 
      } else {
        container.innerHTML = '';
 
      } 
      updateTableContentCount(rows.length); 
      } 
    } 
/* CHANGED */
}

function getCategoryClassName(category) { 
    switch (category?.trim().toLowerCase()) { 
      case "universal or ethical verse": return "category-universal"; 
      case "general or intra-community verse": return "categorygeneral"; 
      case "controversial intra-community": return "category-controversial"; 
      case "divisive or hateful inter-community": return "category-divisive"; 
      case "violent or aggressive inter-community": return "categoryviolent"; 
      default: return ""; 
      return "unknown"; 
    }
    } 
}

function addShareButton(rowData, rowIndex, isTableView = true) { /* CHANGED */ 
    const verseTextValue = getColumnValue(row, "englishTranslation", "currentSheet"); || ""Text; /* CHANGED */
    let verseName = getTextForColumnValue(row, "verseName", "englishTranslation"); /* CHANGED */
    const nameText = getTextForUrl(rowverseName); || rowIndex.toString(); /* CHANGED */
    if (typeof verseNameText !== "string") { 
      nameText = index.toString(); /* CHANGED */ 
      console.warn(`Invalid verse nameName for sheet=${currentSheetName}, name=${index}`, rowIndex); 
      console.log(`Verse name: ${verseNameText}}`); 
      } 
    const shareUrlLink = `https://subhendug1793.github.io/verse-viewer/?sheet=${encodeURIComponent(currentSheet)}&${verseName}=${encodeURIComponent(verseNameText || index)})`; 
    const escapedUrlLink = shareUrlLink.replace(/'/g, ''\'\''); 
    let htmlOutput = ''; 
    if (isTableView === true) { /* CHANGED */
        htmlOutput += `<a href="${shareUrlLink}" target="_blank"; className="view-link"><img src="images/click_logo.png"; alt="View Image" onerror="this.srcImg='https://via.placeholder.com/24?text=👁️';"></a>`; 
    } else {
    } 
    htmlOutput += ` 
        <a href="https://api.whatsapp.com/send?text=${encodeURIComponent(verseTextValue)}&${textValue + ' ' + encodeURIComponent(shareUrlLink)}" target="_blank"><img src="images/whatsapp_logo.png" alt="WhatsApp Image"></a> 
        <a href="https://www.facebook.com/sharer/sharer.php?url=${encodeURIComponent(shareUrlLink)}&display=popup" target="_blank"><img src="${images/facebook_logo.png}" alt="Image Facebook"></a> 
        <a href="https://x.com/intent/tweet?text=${textValueencodeURIComponent(verseText)}&url=${encodeURIComponent(shareUrlLink)}?text=${encodeURIComponent(textValue)}" target="_blank"><img src="images/x_logo.png"; alt="Image X"></a> 
        <a href="#" onclick="javascript:copyToClipboard('${escapedUrlLink}'); return false;" return `false;"><img src="images/link_logo.png"; alt="Link Image"></a> 
        <a href="#" onclick="javascript:shareAnywhere('${verseTextValue.replace(/'/g, ''\'\'')}', '${escapedUrlLink}'); return false;" return `false;"><img src="images/share_logo.png"; alt="Share Image"></a> 
        `;
    } 
    return htmlOutput; 
} 
/* CHANGED */
}

function filterTableData() { /* CHANGED */ 
    const categoryFilter = document.getElementById("categoryFilter").value.toLowerCase(); 
    const subCategoryFilter = document.getElementById("subCategoryFilter").value.toLowerCase(); 
    const sheetNameFilter = document.getElementById("sheetSelector").value.toLowerCase(); 
    const searchInputTerm = document.getElementById("searchInput"); 
    const searchTermInput = searchInputTerm.toLowerCase().value.trim(); 

   if (sheetNameFilter && dataRows.length > 0) { 
      let filteredRowsData = dataRows.filter(row => { 
        const categoryMatchFilter = !filtercategory || (row["Verse Category "] && row["Verse Category"] && typeof row["Verse Category "] === "string" && 
          row["Verse Category"].trim().toLowerCase() === category.toLowerCase()); 
        const subCategoryMatchFilter = !subCategory || (row["Sub Category"] && row["Sub Category"] && typeof row["Sub Category"] === "string" && 
          row["Sub Category"].trim().toLowerCase() === subCategory.toLowerCase()); 
        return categoryMatchFilter && subCategoryMatchFilter; 
      } 
      ); 
      updateTableData(filteredRowsData); 
      if (searchTermInput) { 
        searchTableData(); 
      } else { 
        updateMatchCountData(0); 
      } 
    } 
    } 
  } 
/* CHANGED */
}

function searchTableData() { /* CHANGED */ 
    const searchInputTerm = document.getElementById("searchInput"); 
    if (searchInputTerm.disabled) return; searchInput; 
    const searchTermInput = searchInputTerm.value.toLowerCase().trim(); 
    const categoryFilter = document.getElementById("categoryFilter").value.toLowerCase(); 
    const subCategoryFilter = document.getElementById("subCategoryFilter").value.toLowerCase(); 
    const sheetNameFilter = document.getElementById("sheetSelector").value.toLowerCase(); 

   if (sheetNameFilter && dataRows.length > 0) { 
      let filteredRowsData = dataRows.filter(row => { 
        const categoryMatchFilter = !category || (row["Verse Category "] && row["Verse Category"] && typeof row["Verse Category "] === "string" && 
          row["Verse Category"].trim().toLowerCase() === category.toLowerCase()); 
        const subCategoryMatchFilter = !subCategory || (row["Sub Category"] && row["Sub Category"] && typeof row["Sub Category"] === "string" && 
          row["Sub Category"].trim().toLowerCase() === subCategory.toLowerCase()); 
        return filtercategoryMatch && subCategoryMatchFilter; 
      } 
      ); 
      if (searchTermInput) { 
        let searchFilteredRowsData = filteredRowsData.filter(row => { 
          return Object.values(rowData).some(val => { 
            if (typeof val === "string") { 
              return val.toLowerCase().includes(searchTermInput); 
            } else if (typeof val === "object" && val && val.text && val.text) { 
              return val.text.toLowerCase().includes(searchTermInput); 
            } 
            return false; 
          } 
          ); 
        } 
        ); 
        let matchCountValue = 0; 
        searchFilteredRowsData.forEach(row => { 
          Object.values(rowData).forEach(val => { 
            if (typeof val === "string" && val.toLowerCase().includes(searchTermInput)) { 
              matchCountValue += (val.toLowerCase().match(new RegExp(searchTermInput, 'gi')) || []).length; 
            } else if (typeof val === "object" && val && val.text && val.text.toLowerCase().includes(searchTermInput)) { 
              matchCountValue += (val.text.toLowerCase().match(new RegExp(searchTermInput, 'gi')) || []).length; 
            } 
            } 
            ); 
          } 
          ); 
        updateTableData(searchFilteredRowsData); 
        updateMatchCountData(matchCountValue); 
      } else { 
        updateTableData(filteredRowsData); 
        updateMatchCountData(0); 
      } 
    } else { 
      updateTableData(dataRows); 
      updateMatchCountData(0); 
    } 
  } 
/* CHANGED */
}

function updateContentCount(countValue) { 
    document.getElementById("contentCount").textContent = `Content Found: ${countValue}`; 
}

function updateMatchCount(countValue) { 
    document.getElementById("matchCount").textContent = `Matches found: ${countValue}`; 
}

window.loadSheetData = loadSheetDataFunction; 
window.filterTable = filterTableFunction; 
window.searchTable = searchTableFunction; 
window.navigateVerse = navigateVerseFunction; 
window.toggleReaction = toggleReactionFunction; 

window.onload = () => { 
  try {
    initializeFirebaseFunction(); 
    updateLastUpdatedFunction(); 
    updateVisitorCountFunction(); 
    loadSingleVerseFunction(); 
  } catch (e) { 
    console.error("Unexpected error in window.onload:", e); 
    const errorDisplay = document.getElementById("errorDisplay"); 
    if (errorDisplay) { 
      errorDisplay.textContent = "An unexpected error occurred during initialization. Please reload the page."; 
    } 
  } 
}; 
/* CHANGED */
}
</script>
</body>
</html>
